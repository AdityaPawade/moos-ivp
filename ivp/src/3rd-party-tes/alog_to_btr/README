t. schneider 7.30.07
tes@mit.edu
mit / whoi joint program in ocean engineering

readme for C scripts btr_fix and alog_to_btr. more information is available in the header comments of the *.c files.

purpose:

these programs are intended to fix btr data from the may 2007 project minus experiment.

btr_fix: takes a *.btr file (generated by modified pBearings_DURIP by David Gever or by a pLogger *.alog file run through alog_to_btr) composed of lines of fixed BTRs and corresponding PAEL_TIME timestamps in the format

PAEL_TIME:BTR_DATA\n

and replaces entries of BTR_DATA in all *.alog files present in the input directory. btr_fix tries to match timestamps, and considers a success within 5 seconds. if no timestamp is found, the original, incorrect BTR_DATA in the *.alog file is written over with NaN entries.

alog_to_btr: takes an *.alog file composed completely of PAEL_TIME and BTR_DATA and reformats it into the *.btr file  used by the above process. this is necessary if pLogger is used to log PAEL_TIME and BTR_DATA coming from the corrected raw data files (*.raw) through tcp_file_reader_durip_badpolarity.

overview of entire BTR fixing process:

start with *.raw files written by the PC104 stack for the array during the experiemnt, run them through tcp_file_reader_durip_badpolarity (a modified version of tcp_file_reader_durip that corrects the polarity issue) which writes ACO and NAS files for iVSA, pBearings_DURIP, and pAEL to consume. pLogger is run to record PAEL_TIME and BTR_DATA. alog_to_btr is run on the pLogger file, and finally btr_fix is run on the *.btr file to correct the original *.alog files from the cruise.

detailed process:
1. run MOOS processes (pBearings_DURIP, pAEL, iVSA, pLogger, [uMS]) using settings from the cruise *.moos except only log BTR_DATA and PAEL_TIME.
2. run tcp_file_reader_durip_badpolarity on the raw files to record.
3. wait for tcp_file_reader_durip_badpolarity to finish.
4. run alog_to_btr on the *.alog just generated by pLogger.
5. run btr_fix on the *.btr file (and the original pLogger directory from the cruise date matching the raw files from 1.) just generated by alog_to_btr.


compilation and execution:

to compile btr_fix.c type
make

to compile alog_to_btr.c type
make

binaries are placed in the MOOS-IvP bin directory.

to run btr_fix type
> btr_fix inputfile0.btr directory_with_btr_files > logfile

"> logfile" can be omitted, and the program output will be put to the screen. btr_fix is verbose. there is presently no terse mode.

to run alog_to_btr type
> alog_to_btr < input.alog > output.btr

the i/o redirection (<,>)  is necessary as alog_to_btr uses standard input and writes standard output.